<!DOCTYPE html> 
<html>
    <head>
        <title>Lecture 2, Intuive Music Theory</title>
        <link rel="stylesheet" href="../node_modules/bulma/css/bulma.min.css">
       
    </head>
    
    <body>
        <div class="reveal">
            <div class="slides">

                <section>
                    <h1>Intuitive Music Theory</h1>
                    <h3>Part Two: What is it all for?</h3>
                    <intuitive-allow-audio></intuitive-allow-audio>
                </section>

                <section>
                    
                    <h2>Recap</h2>
                    <ul>
                        <li>...</li>
                        <li>...</li>
                        <li>...</li>
                    </ul>
                </section>

                <section>
                    <h2>Scales</h2>
                    <div class="content">
                    <blockquote>
                        <ul><li>A sequence of notes, often numbering seven.</li>
                            <li>Many songs contain notes from just one scale</li>
                            <li>Given a starting note, 
                                build a scale by adding semitones/tones,<br/> 
                                collecting each new note along the way.</li></ul>
                    </blockquote></div>
                </section>  

                <section data-auto-animate>
                    <intuitive-aural type="major scale" chord="false" duration="0.5" playback="arpeggio"><h3><a>Major scale</a></h3></intuitive-aural>
                    <h4><i>T T S T T T S</i></h4>
                    <intuitive-chromatic-scale-graphic scale="1.5" select="[0,2,4,5,7,9,11,12]" horizontalOffset="1.8" verticalOffset="0.8" steps="13"></intuitive-chromatic-graphic>
                </section>

                <section data-auto-animate>
                    <intuitive-aural type="major scale" chord="false" duration="0.5" playback="arpeggio"><h3><a>Major scale</a></h3></intuitive-aural>
                    <h4><i>T T S T T T S</i></h4><br/><br/>
                    For example, starting on the note D... <br/><br/>
                    <intuitive-keyboard-graphic scale="0.8" octaves="2" select="[3,5,7,8,10,12,14,15]"></intuitive-keyboard-graphic>
                    <br /><br/>
                    <intuitive-basic-fretboard-graphic frets="12" select="[[4,0],[4,2],[4,4],[4,5],[4,7],[4,9],[4,11],[4,12]]"></intuitive-basic-fretboard-graphic>
                    <br /><br/>
                    ...we collect the notes <i>D E F# G A B C# D</i> to get the <i>D major scale</i>
                </section>

                <section data-auto-animate>
                    <intuitive-aural type="natural minor scale" chord="false" duration="0.5" playback="arpeggio"><h3><a>Minor scale</a></h3></intuitive-aural>
                    <h4><i>T S T T S T T</i></h4>
                    <intuitive-chromatic-scale-graphic scale="1.5" select="[0,2,3,5,7,8,10,12]" horizontalOffset="1.8" verticalOffset="0.8" steps="13"></intuitive-chromatic-graphic>
                </section>

                <section data-auto-animate>
                    <intuitive-aural type="natural minor scale" chord="false" duration="0.5" playback="arpeggio"><h3><a>Minor scale</a></h3></intuitive-aural>
                    <h4><i>T S T T S T T</i></h4><br/><br/>
                    For example, starting on the note G... <br/><br/>
                    <intuitive-keyboard-graphic scale="0.8" octaves="2" select="[8,10,11,13,15,16,18,20]"></intuitive-keyboard-graphic>
                    <br /><br/>
                    <intuitive-basic-fretboard-graphic frets="12" select="[[3,0],[3,2],[3,3],[3,5],[3,7],[3,8],[3,10],[3,12]]"></intuitive-basic-fretboard-graphic>
                    <br /><br/>
                    ...we collect the notes <i>G A Bb C D Eb F G</i> to get the <i>G minor scale</i>
                </section>


                <section>
                    <h2>Chords</h2>
                    <div class="content">
                    <blockquote>
                    <ul>
                        <li>Three or more notes, often played at the same time</li>
                        <li>May be built out of notes from a scale</li>
                        <li>Combine two semitones/tones to achieve bigger gaps</li>
                    </ul>
                    </blockquote></div>
                </section>  

                <section data-auto-animate>
                    <intuitive-aural type="major triad" duration="0.5" playback="arpeggio chord"><h3><a>Major Triad</a></h3></intuitive-aural>
                    <h4><i>T+T T+S</i></h4>
                    <intuitive-chromatic-scale-graphic scale="1.5" select="[0,4,7]" horizontalOffset="1.8" verticalOffset="0.8" steps="13"></intuitive-chromatic-graphic>
                </section>

                <section data-auto-animate>
                    <intuitive-aural type="major triad" duration="0.5" playback="arpeggio chord"><h3><a>Major Triad</a></h3></intuitive-aural>
                    <h4><i>T+T S+T</i></h4><br/><br/>
                    For example, starting on the note E... <br/><br/>
                    <intuitive-keyboard-graphic scale="0.8" octaves="2" select="[5,9,12]"></intuitive-keyboard-graphic>
                    <br /><br/>
                    <intuitive-basic-fretboard-graphic frets="12" select="[[4,2],[3,1],[2,0]]"></intuitive-basic-fretboard-graphic>
                    <br /><br/>
                    ...we collect the notes <i>E G# B</i> to get the <i>E major triad</i>
                </section>

                <section data-auto-animate>
                    <intuitive-aural type="minor triad" duration="0.5" playback="arpeggio chord"><h3><a>Minor Triad</a></h3></intuitive-aural>
                    <h4><i>T+S T+T</i></h4>
                    <intuitive-chromatic-scale-graphic scale="1.5" select="[0,3,7]" horizontalOffset="1.8" verticalOffset="0.8" steps="13"></intuitive-chromatic-graphic>
                </section>

                <section data-auto-animate>
                    <intuitive-aural type="minor triad" duration="0.5" playback="arpeggio chord"><h3><a>Minor Triad</a></h3></intuitive-aural>
                    <h4><i>T+S T+T</i></h4><br/><br/>
                    For example, starting on the note Bb... <br/><br/>
                    <intuitive-keyboard-graphic scale="0.8" octaves="2" select="[11,14,18]"></intuitive-keyboard-graphic>
                    <br /><br/>
                    <intuitive-basic-fretboard-graphic frets="12" select="[[6,6],[5,4],[4,3]]"></intuitive-basic-fretboard-graphic>
                    <br /><br/>
                    ...we collect the notes <i>Bb Db F</i> to get the <i>Bb Minor Triad</i>
                </section>

                <section data-auto-animate>
                    <intuitive-aural type="diminished triad" duration="0.5" playback="arpeggio chord"><h3><a>Diminshed Triad</a></h3></intuitive-aural>
                    <h4><i>T+S T+S</i></h4>
                    <intuitive-chromatic-scale-graphic scale="1.5" select="[0,3,6]" horizontalOffset="1.8" verticalOffset="0.8" steps="13"></intuitive-chromatic-graphic>
                </section>

                <section data-auto-animate>
                    <intuitive-aural type="diminished triad" duration="0.5" playback="arpeggio chord"><h3><a>Diminshed Triad</a></h3></intuitive-aural>
                    <h4><i>T+S T+S</i></h4><br/><br/>
                    For example, starting on the note A... <br/><br/>
                    <intuitive-keyboard-graphic scale="0.8" octaves="2" select="[10,13,16]"></intuitive-keyboard-graphic>
                    <br /><br/>
                    <intuitive-basic-fretboard-graphic frets="12" select="[[4,7],[3,5],[2,4]]"></intuitive-basic-fretboard-graphic>
                    <br /><br/>
                    ...we collect the notes <i>A C Eb</i> to get the <i>A Diminshed Triad</i>
                </section>
            
                <section>
                    <h2>Scale Degrees</h2>
                    <intuitive-encircle><b>1 2 3 4 5 6 7</b></intuitive-encircle>
                </section>
                <section>
                    <div class="container">
                        <h2>It's All Relative</h2>

                        <div class="tile is-ancestor">
                            <div class="tile is-parent is-vertical">

                                <div class="tile is-child">
                                    <intuitive-tune-player tempo="105" transpose="random" title="Recognise this?">
                                        c4,8n d e f g a b c5
                                    </intuitive-tune-player>
                                </div>



                                <article class="tile is-child is-info notification">
                                <ul>
                                    <li>One <span class="fragment" data-fragment-index="1">major scale</span>  is as good as another </li>
                                    <li><b>What is true for one <span class="fragment" data-fragment-index="1">major scale</span> <br/> is true for <i>any</i> <span class="fragment" data-fragment-index="1">major scale</span></b></li>
                                </ul>
                                </article>
                            </div>
                        </div>
                    </div>
                </section>

                <section>

                    <h3>Scale Degrees</h3>
                    <br/>
                    <table id="scaledegrees1">
                        <tr id="top">
                            
                            <td colspan="2"><i>1</i></td>
                            <td colspan="2"><i>2</i></td>
                            <td colspan="1"><i>3</i></td>
                            <td colspan="2"><i>4</i></td>
                            <td colspan="2"><i>5</i></td>
                            <td colspan="2"><i>6</i></td>
                            <td colspan="1"><i>7</i></td>
                        </tr >
                        <tr id="bottom">
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>

                        </tr>
                    </table> <br/>
                    <button class="button is-warning is-large" id="newscale"> New Scale </button>
                    <!-- <p><intuitive-encircle>1 T 2 T 3 S 4 T 5 T 6 T 7 S 1</intuitive-encircle></p> -->

                    <script>
                        const fifths = ["F", "C", "G", "D", "A", "E", "B"];
                        
                        const accidentals = ["𝄫", "♭", "♮", "♯", "𝄪"];
                        const majorScaleOffsets = [0, 2, 4, -1, 1, 3, 5];
                        const chromaticScaleOffsets = [[0], [7, -5], [2], [9, -3], [4], [-1], [6, -6], [1], [8, -4], [3], [10, -2], [5]]
                        const chromaticIndicies = [1, 3, 6, 8, 10]
                        const product = (arrA, arrB) => arrA.map(a => arrB.map(b => b + a));
                        const circleOfFifths = product(accidentals, fifths).flat();
                        const scaleRoots = product(accidentals.slice(1, 4), fifths).flat();
                        const deepMap = (arr, fn) => arr.map(inner => inner.map(fn));
                        const getScaleIndices = root => deepMap(chromaticScaleOffsets, o => o + circleOfFifths.indexOf(root));
                        const getScaleNotes = indicies => deepMap(indicies, (i => circleOfFifths[i]));

                        const naturalFifths = product(["♮"], fifths).flat();
                        const doubleAccs = product(["𝄫","𝄪"], fifths).flat();
                        
                        function render(arr) {
                            arr = arr.filter(e => e !== undefined);
                            if(arr.length == 1) { 
                                if(naturalFifths.includes(arr[0])) { return arr[0].slice(0, 1); }
                                else { return arr[0]; }
                            }
                            else { 
                                console.assert(arr.length == 2);
                                
                                let redundantEnharmonic = arr.find(e => naturalFifths.includes(e));
                                if(redundantEnharmonic === undefined) { 
                                    const finder = e => doubleAccs.includes(e)
                                    redundantEnharmonic = arr.findIndex(finder);
                                    if(redundantEnharmonic == -1) { return `${arr[0]} / ${arr[1]}` }
                                    else { return arr[1 - redundantEnharmonic]; }
                                }
                                else  { return redundantEnharmonic; }
                            }
                        }

                        const getChromaticScale = root => getScaleNotes(getScaleIndices(root)).map(render);
                        const padScale = (scale, n) => Array.prototype.concat(scale.slice(-1 * n), scale, scale.slice(0, n));
                        const shrinkChromaticNotes = (note, index) => 
                            chromaticIndicies.includes(index) ? 
                                `<span class="is-size-4 has-text-grey-light">${note}</span>` :
                                note;
                                

                      //scaleRoots.forEach(root => console.log(padScale(getChromaticScale(root), 2)));

                        function addScaleToBottomRow(root) {
                            console.assert(scaleRoots.includes(root));
                            const bottomRow = document.querySelectorAll("table#scaledegrees1 tr#bottom td");
                            const notes = getChromaticScale(root);
                            const formatted = notes
                                .map(n => `<i>${n}</i>`)
                                .map(shrinkChromaticNotes);
                            bottomRow.forEach( (td, index) => td.innerHTML = formatted[index] );
                        }

                        addScaleToBottomRow("D♮");

                        const newScaleButton = document.querySelector("button#newscale");
                        const randomElement = arr => arr[Math.floor(Math.random() * arr.length)];
                        
                        // Snippet from https://chrisbuttery.com/articles/fade-in-fade-out-with-javascript/
                        // fade out
                        function fadeOut(els, callback){
                            els.forEach(el => el.style.opacity = 1);

                            (function fade() {
                                let val = parseFloat(els[0].style.opacity);
                                if (val > 0) {
                                    val = val - 0.1;
                                    els.forEach(el => el.style.opacity = val);
                                    requestAnimationFrame(fade);
                                } else {
                                    callback();
                                }
                            })();
                        }

                        // fade in
                        function fadeIn(els, display){
                            els.forEach(el => {
                                el.style.opacity = 0;
                                //el.style.display = display || "block";
                            });

                            (function fade() {
                                var val = parseFloat(els[0].style.opacity);
                                if (!((val += .1) > 1)) {
                                    els.forEach(el => el.style.opacity = val);
                                    requestAnimationFrame(fade);
                                }
                            })();
                        }

                        const allTDs = document.querySelectorAll("table#scaledegrees1 tr td");

                        // End snippet
                        newScaleButton.onclick = () => {
                            fadeOut(allTDs, () => {
                                addScaleToBottomRow(randomElement(scaleRoots));
                                fadeIn(allTDs);
                            })
                        };
                    </script>
                </section>

            </div>
        </div>

        <script src="./lecture2.ts"></script>
    </body>
</html>
